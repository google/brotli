language:
- objective-c
env:
  matrix:
  - INSTALL_TYPE='system' VERSION=2.7
  - INSTALL_TYPE='macpython' VERSION=2.7.10 CC=clang CXX=clang++
  - INSTALL_TYPE='macpython' VERSION=3.4.3 CC=clang CXX=clang++
  - INSTALL_TYPE='homebrew' VERSION=2.7.10
  - INSTALL_TYPE='homebrew' VERSION=3.4.3
  global:
   # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
   #   via the "travis encrypt" command using the project repo's public key
   - secure: "N9gWONR0+iou47KvLFVSHQwcjk9UkI64bX5uHy1fmbqpubNpHxDXhCE15EzOgE84qXjYNb7QIAVw2d9X/ocw0S8MKxmsiyqhgwPI3Ra/k8pRsvD/I1ueFHfymb7Ml+6bCTRomJJn5Acv45fr+QAwEokCPR9pDGllgdsWlP9YP90="
install:
- source terryfy/travis_tools.sh
- get_python_environment $INSTALL_TYPE $VERSION venv
- pip install --upgrade wheel
script:
- python setup.py build_ext test
after_success:
- pip wheel -w dist .
before_deploy:
- export WHEELS=$(ls ./dist/*.whl)

deploy:
  provider: releases
  api_key:
    secure: YcCBi6W/w4dtKCa59Wfm8L5lGWvK7KxaFNDr3yh1Hz5aStXXf758pEMHGewnlbfbwuj5a3SjBb1nLp1M69OQJfxm442uXBaBKo52PM9PPbD7NjvbNIso73pqcSODXQXKuZxDFpEhfuDTVq3hUkUqiwhChWhrFucJsSL51i7qSss=
  file:
    - "${WHEELS}"
  skip_cleanup: true
  on:
    repo: google/brotli
    tags: true

addons:
  coverity_scan:
    project:
      name: "google/brotli"
      description: "Build submitted via Travis CI"
    notification_email: eustas.ru@gmail.com
    build_command_prepend: "make clean"
    build_command:   "make"
    branch_pattern: coverity_scan
